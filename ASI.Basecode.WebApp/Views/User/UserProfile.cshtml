@model UserProfileViewModel

@{
    ViewData["Title"] = "User Profile";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}

<div class="flex justify-center items-center w-screen h-full bg-[#FFEACC] px-8">
    <div class="bg-white rounded-2xl shadow-2xl flex flex-row w-full w-[90%] h-[90%] ">
        <!-- Left Column -->
        <div class="flex flex-col items-center justify-center w-1/2 p-4 border-r border-[#FFEACC]">
            <!-- Profile Image -->
            <div class="relative mb-2">
                <img id="profile-pic-main" src="@Model.ProfilePicture" alt="Profile" class="rounded-full w-[300px] h-[300px] object-cover border-4 border-[#FFEACC] shadow cursor-pointer" onclick="triggerProfilePicUpload()" />
                <input type="file" id="ProfilePictureFile" name="ProfilePictureFile" accept="image/*" class="hidden" onchange="previewProfilePic(event)" />
            </div>
            <!-- User Info -->
            <div class="text-center mt-2">
                <div class="font-bold text-xl">@Model.FirstName @Model.LastName</div>
                <div class="text-gray-500 text-sm">Account ID: @Model.Id</div>
                <div class="text-gray-500 text-sm">Account Created: @Model.CreatedTime.ToString("MM/dd/yyyy")</div>
                <div class="text-gray-500 text-sm">@Model.EmailId</div>
            </div>
            <span class="bg-yellow-300 text-black px-4 py-1 rounded-full mt-2 text-xs font-semibold">Guest</span>
            <button type="button" class="bg-[#800000] text-white px-8 py-2 rounded-lg mt-6 flex items-center gap-2 hover:bg-[#a83232] transition" onclick="openDeleteUserModal(@Model.Id, '@Model.FirstName @Model.LastName', '@Model.ProfilePicture')">
                <span>⚠️</span> Delete Account
            </button>
        </div>
        <!-- Right Column -->
        <div class="flex flex-col w-1/2 py-2 px-6 justify-center">
            <div class="font-bold text-2xl text-[#800000]">PROFILE DETAILS</div>
            <!-- View Mode -->
            <div id="profile-view" class="flex flex-col gap-2 mt-2">
                <div>
                    <span class="block text-sm font-semibold mb-1">First Name</span>
                    <span class="block px-3 py-2">@Model.FirstName</span>
                </div>
                <div>
                    <span class="block text-sm font-semibold mb-1">Last Name</span>
                    <span class="block px-3 py-2">@Model.LastName</span>
                </div>
                <div>
                    <span class="block text-sm font-semibold mb-1">Birthdate</span>
                    <span class="block px-3 py-2">@Model.Birthdate?.ToString("MM/dd/yyyy")</span>
                </div>
                <div>
                    <span class="block text-sm font-semibold mb-1">Contact No.</span>
                    <span class="block px-3 py-2">@Model.Contact</span>
                </div>
                <div>
                    <span class="block text-sm font-semibold mb-1">Email</span>
                    <span class="block px-3 py-2">@Model.EmailId</span>
                </div>
                <div>
                    <span class="block text-sm font-semibold mb-1">Password</span>
                    <span class="block px-3 py-2">******</span>
                </div>
                <button type="button" onclick="toggleEdit(true)" class="bg-[#800000] text-white font-semibold rounded-lg py-3 mt-4 hover:bg-[#a83232] transition text-center">Edit Profile</button>
            </div>
            <!-- Edit Mode -->
            <form asp-controller="User" asp-action="UserProfileEdit" id="profile-edit" class="flex flex-col gap-2 mt-4 hidden" enctype="multipart/form-data" method="post" onsubmit="return moveFileInputToForm()">
                <input type="hidden" name="Id" value="@Model.Id" />
                <span id="file-input-placeholder"></span>
                <div>
                    <label class="block text-sm font-semibold mb-1" for="FirstName">First Name</label>
                    <input id="FirstName" name="FirstName" type="text" value="@Model.FirstName" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#800000] transition" />
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1" for="LastName">Last Name</label>
                    <input id="LastName" name="LastName" type="text" value="@Model.LastName" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#800000] transition" />
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1" for="Birthdate">Birthdate</label>
                    <input id="Birthdate" name="Birthdate" type="date" value="@Model.Birthdate?.ToString("yyyy-MM-dd")" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#800000] transition" />
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1" for="Contact">Contact No.</label>
                    <input id="Contact" name="Contact" type="text" value="@Model.Contact" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#800000] transition" />
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1" for="EmailId">Email</label>
                    <input id="EmailId" name="EmailId" type="email" value="@Model.EmailId" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#800000] transition" />
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1" for="Password">Password</label>
                    <input id="Password" name="Password" type="password" placeholder="Leave blank for no change" value="" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#800000] transition"/>
                </div>
                <div class="flex gap-2 mt-2 justify-around items-center">
                    <button type="submit" class="bg-[#800000] text-white font-semibold rounded-lg py-3 hover:bg-[#a83232] transition w-1/3">Save Changes</button>
                    <button type="button" onclick="toggleEdit(false)" class="text-[#800000] underline font-semibold w-1/3">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

@await Html.PartialAsync("DeleteUser", Model)

<script>
    function toggleEdit(isEdit) {
        document.getElementById('profile-view').classList.toggle('hidden', isEdit);
        document.getElementById('profile-edit').classList.toggle('hidden', !isEdit);
        // Enable/disable profile picture upload in edit mode
        document.getElementById('profile-pic-main').style.pointerEvents = isEdit ? 'auto' : 'none';
        document.getElementById('profile-pic-main').style.opacity = isEdit ? '1' : '1';
    }
    function triggerProfilePicUpload() {
        // Only allow file selection in edit mode
        if (!document.getElementById('profile-edit').classList.contains('hidden')) {
            document.getElementById('ProfilePictureFile').click();
        }
    }
    function previewProfilePic(event) {
        const [file] = event.target.files;
        if (file) {
            document.getElementById('profile-pic-main').src = URL.createObjectURL(file);
        }
    }
    function moveFileInputToForm() {
        var fileInput = document.getElementById('ProfilePictureFile');
        var placeholder = document.getElementById('file-input-placeholder');
        if (placeholder && fileInput && !placeholder.contains(fileInput)) {
            placeholder.appendChild(fileInput);
            console.log("File input moved into form.");
        }
        return true;
    }
   
</script>