@model ASI.Basecode.Services.ServiceModels.AdminCreateUserViewModel

@{
    ViewData["Title"] = "Ma22 | Profiles";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var filter = Context.Request.Query["filter"].ToString() ?? "all";
}

@if (TempData["Success"] != null)
{
    <div class="mx-20 my-3 rounded bg-green-100 px-4 py-2 text-green-800">
        ✅ @TempData["Success"]
    </div>
}

@if (TempData["FormError"] != null)
{
    <div class="mx-20 my-3 rounded bg-red-100 px-4 py-2 text-red-800">
        ⚠️ @TempData["FormError"]
    </div>
}

<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

<!-- Header -->
<div class="mx-20 mb-6 mt-12 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
    <h1 class="text-4xl font-bold uppercase text-gray-800">User Panel</h1>

    <form class="w-full sm:w-auto" method="get" action="@Url.Action("UserMaster")">
        <input type="hidden" name="filter" value="@filter" />
        <div class="relative w-full sm:w-[380px]">
            <span class="material-symbols-outlined -translate-y-1/2 absolute left-3 top-1/2 text-gray-400">search</span>
            <input type="search" name="search" id="default-search"
                   class="h-12 w-full rounded-full border border-gray-300 bg-white pl-10 pr-[90px] text-sm text-gray-900 shadow-sm transition focus:outline-none focus:ring-2 focus:ring-[#EAC231]"
                   placeholder="Search Users..." value="@Context.Request.Query["search"]" />
            <button type="submit"
                    class="absolute right-2 top-[6px] rounded-full bg-[#EAC231] px-4 py-2 text-sm font-medium text-black transition hover:bg-[#cfa221]">
                Search
            </button>
        </div>
    </form>
</div>

<hr class="mx-20 my-4 border-t-2 border-[#640A16]" />

<!-- Filter Tabs and Add User -->
<div class="mx-20 mb-6 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center">
    <div class="flex gap-6 text-base font-medium text-gray-600">
        <a href="@Url.Action("UserMaster", new { page = 1, filter = "all" })" class="transition hover:text-black">All (@Model.TotalUsers)</a>
        <a href="@Url.Action("UserMaster", new { page = 1, filter = "admin" })" class="transition hover:text-black">Admin (@Model.TotalAdmins)</a>
        <a href="@Url.Action("UserMaster", new { page = 1, filter = "guest" })" class="transition hover:text-black">Guest (@Model.TotalGuests)</a>
    </div>

    <button onclick="openModal()" class="rounded-full bg-[#EAC231] px-5 py-2 text-sm font-semibold text-black shadow-md transition hover:bg-[#cfa221]">
        Add User +
    </button>
</div>

<!-- Table -->
<div class="mx-20 overflow-x-auto rounded-xl bg-white shadow-lg">
    <table class="w-full text-left text-sm text-black">
        <thead class="bg-[#640A16] text-sm uppercase tracking-wide text-white">
            <tr>
                <th scope="col" class="px-6 py-3 text-left">User</th>
                <th scope="col" class="px-6 py-3 text-left">Position</th>
                <th scope="col" class="px-6 py-3 text-center">Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Users != null && Model.Users.Any())
            {
                foreach (var user in Model.Users)
                {
                    <tr class="border-b transition hover:bg-gray-50">
                        <th scope="row" class="flex items-center gap-3 whitespace-nowrap px-6 py-4 text-sm text-gray-900">
                            @if (!string.IsNullOrEmpty(user.ProfilePicture))
                            {
                                <img src="@user.ProfilePicture" alt="Profile" class="h-10 w-10 rounded-full object-cover" />
                            }
                            else
                            {
                                <span class="text-2xl">👤</span>
                            }
                            <span>@($"{user.FirstName} {user.LastName}")</span>
                        </th>

                        <td class="px-6 py-4 text-sm text-gray-700">@(user.Role == 0 ? "Admin" : "Guest")</td>

                        <td class="px-6 py-4">
                            <div class="flex justify-center gap-5 text-gray-600">
                                <a href="javascript:void(0);" onclick="editDetails(@user.Id)">
                                    <span class="material-symbols-outlined cursor-pointer text-[22px] transition hover:text-black">Edit</span>
                                </a>
                                <a href="javascript:void(0);" onclick="viewDetails(@user.Id)">
                                    <span class="material-symbols-outlined cursor-pointer text-[22px] transition hover:text-black">Visibility</span>
                                </a>
                                <a onclick="deleteProfile(@user.Id, '@user.FirstName @user.LastName', '@(user.ProfilePicture ?? "")')">
                                    <span class="material-symbols-outlined cursor-pointer text-[22px] text-red-600 transition hover:text-red-800">Delete</span>
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="3" class="py-4 text-center text-gray-500">No users found.</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Pagination -->
<div class="mx-20 mt-10 flex justify-end">
    <nav aria-label="Page navigation">
        <ul class="flex gap-1 text-sm">
            @if (Model.CurrentPage > 1)
            {
                <li>
                    <a href="@Url.Action("UserMaster", new { page = Model.CurrentPage - 1, filter = filter })"
                       class="rounded-l-full border border-gray-300 bg-white px-3 py-2 text-gray-600 transition hover:bg-gray-100 hover:text-black">Prev</a>
                </li>
            }

            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li>
                    <a href="@Url.Action("UserMaster", new { page = i, filter = filter })"
                       class="border border-gray-300 bg-white px-3 py-2 text-gray-600 transition hover:bg-gray-100 hover:text-black @(i == Model.CurrentPage ? "bg-[#EAC231] text-black font-semibold" : "")">@i</a>
                </li>
            }

            @if (Model.CurrentPage < Model.TotalPages)
            {
                <li>
                    <a href="@Url.Action("UserMaster", new { page = Model.CurrentPage + 1, filter = filter })"
                       class="rounded-r-full border border-gray-300 bg-white px-3 py-2 text-gray-600 transition hover:bg-gray-100 hover:text-black">Next</a>
                </li>
            }
        </ul>
    </nav>
</div>

@await Html.PartialAsync("_UserAddModal")
@await Html.PartialAsync("_UserEditModal")
@await Html.PartialAsync("_UserDeleteModal")

<!-- AJAX dynamic modal content -->
<div id="viewUserModalContainer"></div>

<!-- UserMaster AJAX Script -->
<script src="~/js/usermaster_AJAX.js" asp-append-version="true"></script>