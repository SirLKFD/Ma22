<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

@{
    ViewData["Title"] = "Edit User Modal Page";
}

<div id="editUserModal" class="fixed inset-0 z-50 flex hidden items-center justify-center bg-black bg-opacity-40 backdrop-blur-sm">
    <div class="animate-slide-up animate-fade-in relative flex max-h-[80vh] w-full max-w-6xl flex-row rounded-xl bg-[#640A16] opacity-0 shadow-lg">
        <div class="flex w-[450px] flex-col items-center justify-center rounded-l-xl bg-white">
            <div class="absolute left-5 top-5">
                <a onclick="closeEditDetails()" class="hover-pointer">
                    <span class="material-symbols-outlined text-[50px]">arrow_circle_left</span>
                </a>
            </div>

            <label for="editProfilePictureInput" class="mt-[-50px] mb-3 block h-[250px] w-[250px] cursor-pointer">
                <div id="editProfileImageContainer" class="flex h-full w-full items-center justify-center rounded-full border-4 border-[#FFE9C6] bg-[#FFE9C6] bg-[#FFE9C6] shadow-lg">
                    <h1 id="editProfilePlaceholder" class="text-5xl">+</h1>
                    <img id="editProfileImage" src="" alt="Profile" class="hidden h-full w-full rounded-full object-cover" />
                </div>
            </label>

            <div class="flex flex-col items-center gap-1">
                <h1 id="editUserName" class="text-2xl uppercase">User Name</h1>
                <h2 id="editUserId" class="text-sm">ID: </h2>
                <h2 id="editUserCreated" class="text-sm">Account Created: </h2>
                <h2 id="editUserEmail" class="text-sm">user@email.com</h2>
                
            </div>
        </div>

        <div class="flex-1 p-5">
            <h2 class="mb-4 text-2xl font-bold uppercase text-white">Edit Profile Details</h2>

            <form id="editUserForm" asp-action="UpdateUser" method="post" enctype="multipart/form-data" class="space-y-4">
                <input type="hidden" id="editUserIdInput" name="Id" value="0" />
                <input type="hidden" name="fromSidebar" value="true" />

                <input type="hidden" id="editExistingProfilePicture" name="ExistingProfilePicture" value="" />

                <input id="editProfilePictureInput"
                       name="ProfilePicture"
                       type="file"
                       accept="image/*"
                       class="hidden" />

                <div>
                    <div class="flex items-center justify-between">
                        <label class="w-32 text-white">First Name</label>
                        <input id="editFirstName" name="FirstName" class="w-[400px] rounded-xl border p-2" required />
                    </div>
                    <span id="editFirstNameError" class="block hidden text-sm text-[#EAC231]"></span>
                </div>

                <div>
                    <div class="flex items-center justify-between">
                        <label class="w-32 text-white">Last Name</label>
                        <input id="editLastName" name="LastName" class="w-[400px] rounded-xl border p-2" required />
                    </div>
                    <span id="editLastNameError" class="block hidden text-sm text-[#EAC231]"></span>
                </div>

                <div>
                    <div class="flex items-center justify-between">
                        <label class="w-32 text-white">Birthdate</label>
                        <input type="date" id="editBirthdate" name="Birthdate" class="w-[400px] rounded-xl border p-2" />
                    </div>
                </div>

                <div>
                    <div class="flex items-center justify-between">
                        <label class="w-32 text-white">Contact No. (Optional)</label>
                        <input id="editContact" name="Contact" class="w-[400px] rounded-xl border p-2" />
                    </div>
                    <span id="editContactError" class="block hidden text-sm text-[#EAC231]"></span>
                </div>

                <div>
                    <div class="flex items-center justify-between">
                        <label class="w-32 text-white">Email</label>
                        <input id="editEmail" name="EmailId" type="email" class="w-[400px] rounded-xl border p-2" required />
                    </div>
                    <span id="editEmailError" class="block hidden text-sm text-[#EAC231]"></span>
                </div>

                <div>
                    <div class="flex items-center justify-between">
                        <label class="w-32 text-white">Password</label>
                        <input id="editPassword" name="Password" type="password" class="w-[400px] rounded-xl border p-2" placeholder="Leave blank to keep current password" />
                    </div>
                    <span id="editPasswordError" class="block hidden text-sm text-[#EAC231]"></span>
                </div>

                <div>
                    <div class="flex items-center justify-between">
                        <label class="w-32 text-white">Confirm Password</label>
                        <input id="editConfirmPassword" name="ConfirmPassword" type="password" class="w-[400px] rounded-xl border p-2" placeholder="Re-enter password to confirm" />
                    </div>
                    <span id="editConfirmPasswordError" class="block hidden text-sm text-[#EAC231]"></span>
                </div>

                @{
                    var userRole = Context.Session.GetInt32("AccountRole");
                }

                @if (userRole == 2)
                {
                    <div>
                        <div class="flex items-center justify-between">
                            <label class="w-32 text-white">Role</label>
                            <select id="editRole" name="Role" class="w-[400px] rounded-xl border bg-[#EAC231] p-2 font-semibold text-black" required>
                                <option value="0">Admin</option>
                                <option value="1">Guest</option>
                                <option value="2">Superadmin</option>
                            </select>
                        </div>
                        <span id="editRoleError" class="block hidden text-sm text-[#EAC231]"></span>
                    </div>
                }

                <div class="flex justify-center pt-4">
                    <button type="submit" id="editUserBtn" class="w-[400px] rounded bg-[#FFE9C6] px-6 py-2 font-bold text-black hover:bg-[#e6c89c]">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- User Edit Modal AJAX Script -->
<script src="~/js/usereditmodal_AJAX.js" asp-append-version="true"></script>
<script>
document.getElementById('editUserForm').addEventListener('submit', function(e) {
    var btn = document.getElementById('editUserBtn');
    if (btn) {
        btn.disabled = true;
        btn.innerHTML = '<span class="flex items-center justify-center w-full"><span class="spinner-border spinner-border-sm mr-2"></span><span>Saving...</span></span>';
    }
});
</script>