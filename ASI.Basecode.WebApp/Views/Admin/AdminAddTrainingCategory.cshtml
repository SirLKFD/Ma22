@model TrainingCategoryViewModel
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

<div id="addTrainingCategory" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 backdrop-blur-sm hidden">
    <div class="flex max-h-[700px] w-full max-w-3xl flex-col rounded-xl bg-[#640A16] text-white shadow-lg p-6 animate-slide-up opacity-0 animate-fade-in">
        <div class="flex">
            <a onclick="closeTrainingCategory()" class="hover-pointer">
                <span class="material-symbols-outlined text-[50px]">arrow_circle_left</span>
            </a>
        </div>
        <div class="flex align-items-center justify-start w-full my-3">
            <h1 class="uppercase text-2xl font-weight-bold">Add New Training Category</h1>
        </div>
        <form asp-action="AddTrainingCategory" asp-controller="AdminTrainingCategory" method="post" enctype="multipart/form-data"class="flex flex-col gap-4">
            <label for="CoverPictureAdd" class="flex flex-col items-center justify-center bg-white h-[150px] w-full rounded-xl cursor-pointer">
                <input type="file"
                       name="CoverPictureAdd"
                       id="CoverPictureAdd"
                       accept="image/*"
                       class="hidden" />
                <img id="CoverPictureAddPreview" alt="Cover Picture" class="w-full h-full object-cover rounded-xl hidden" />
                <span id="CoverPictureAddPlaceholder" class="material-symbols-outlined text-[50px] text-black">add_photo_alternate</span>
                <h1 id="CoverPictureAddText" class="text-black uppercase">Upload Cover Photo</h1>
            </label>

            <div class="flex flex-col gap-4">
                
                <div>
                    <label asp-for="CategoryName" class="block text-sm font-medium text-white mb-2">Category Name</label>
                    <input asp-for="CategoryName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#EAC231] text-black" />
                    <span asp-validation-for="CategoryName" class="text-red-500 text-sm"></span>
                </div>
                <div>
                    <label asp-for="Description" class="block text-sm font-medium text-white mb-2">Description</label>
                    <textarea asp-for="Description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#EAC231] text-black"></textarea>
                    <span asp-validation-for="Description" class="text-red-500 text-sm"></span>
                </div>
                <button id="addTrainingCategoryBtn" class="bg-[#FFE9C6] hover:bg-[#e6c89c] w-2/3 text-black align-self-center py-2 rounded-xl font-weight-bold ">
                    Add Training Category
                </button>
            </div>
        </form>
    </div>
</div>

@if (ViewBag.NewCategory != null)
{
    var cat = ViewBag.NewCategory;
    <div class="alert alert-success mt-3">
        <strong>New Training Category Added:</strong><br />
        Name: @cat.CategoryName <br />
        Description: @cat.Description <br />
        @if (!string.IsNullOrEmpty(cat.CoverPicture))
        {
            <img src="@cat.CoverPicture" alt="Cover Picture" style="max-width:100px;max-height:100px;" />
        }
    </div>
}

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}

<script>
    // Show preview of uploaded image when a new file is selected in Add modal
    document.getElementById('CoverPictureAdd').addEventListener('change', function() {
        const file = this.files[0];
        const imageElement = document.getElementById('CoverPictureAddPreview');
        const placeholderElement = document.getElementById('CoverPictureAddPlaceholder');
        const textElement = document.getElementById('CoverPictureAddText');
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imageElement.src = e.target.result;
                imageElement.classList.remove('hidden');
                placeholderElement.classList.add('hidden');
                placeholderElement.classList.remove('material-symbols-outlined');
                textElement.classList.add('hidden');
            };
            reader.readAsDataURL(file);
        } else {
            imageElement.classList.add('hidden');
            placeholderElement.classList.remove('hidden');
            placeholderElement.classList.add('material-symbols-outlined');
            textElement.classList.remove('hidden');
        }
    });
    // Add loading state to Add Training Category button
    document.querySelector('#addTrainingCategory form').addEventListener('submit', function(e) {
        var btn = document.getElementById('addTrainingCategoryBtn');
        if (btn) {
            btn.disabled = true;
            btn.innerHTML = '<span class="flex items-center justify-center w-full"><span class="spinner-border spinner-border-sm mr-2"></span><span>Adding...</span></span>';
        }
    });
</script>


