@model TopicViewModel
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

<div id="addTopic" class="fixed inset-0 z-50 flex hidden items-center justify-center bg-black bg-opacity-40 backdrop-blur-sm">
    <div class="flex max-h-[90vh] w-full max-w-5xl flex-col rounded-xl bg-white p-6 text-black shadow-lg">

        <div class="flex">
            <a onclick="closeAddTopic()" class="hover-pointer">
                <span class="material-symbols-outlined text-[50px]">arrow_circle_left</span>
            </a>
        </div>
        <div class="align-items-center mx-5 my-3 flex w-full justify-start">
            <h1 class="font-weight-bold text-2xl uppercase">Add New Topic</h1>
        </div>
        <form asp-controller="AdminTopic" asp-action="AddTopic" method="post" enctype="multipart/form-data">
            <div class="flex">
                <!-- Left side with form fields -->
                <input type="hidden" asp-for="TrainingId" id="TrainingId" />
                <div class="flex w-1/2 flex-col">
                    <div class="mx-5 mt-2">
                        <label asp-for="TopicName" class="mb-2 block text-sm font-medium text-black">Topic Name</label>
                        <input asp-for="TopicName" class="w-full rounded-md border border-gray-300 px-3 py-2 text-black focus:outline-none focus:ring-2 focus:ring-[#EAC231]" />
                        <span asp-validation-for="TopicName" class="text-danger"></span>
                    </div>

                    <div class="mx-5 mt-2">
                        <label asp-for="Description" class="mb-2 block text-sm font-medium text-black">Description</label>
                        <textarea asp-for="Description" rows="12" class="w-full rounded-md border border-gray-300 px-3 py-2 text-black focus:outline-none focus:ring-2 focus:ring-[#EAC231]"></textarea>
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>

                    <button class="mx-5 mt-4 rounded-lg bg-[#FFE9C6] px-4 py-2 font-semibold">Add Topic</button>
                </div>

                <div class="flex w-1/2 flex-col gap-2 rounded-lg bg-[#640A16] p-4 text-white">
                    <h2 class="text-2xl font-semibold">Resources</h2>

                    <div class="flex flex-1 flex-col gap-2">
                        <!-- Videos -->
                        <div class="flex flex-1 flex-col">
                            <div class="flex justify-between">
                                <p class="text-lg">Videos</p>
                                <label for="VideoFilesAdd" class="cursor-pointer">
                                    <input type="file"
                                           name="VideoFilesAdd"
                                           id="VideoFilesAdd"
                                           accept="video/*"
                                           multiple
                                           class="hidden" />
                                    <div class="flex items-center text-white">
                                        <span class="material-symbols-outlined">add_photo_alternate</span>
                                        <h1 class="font-semibold uppercase">Upload</h1>
                                    </div>
                                </label>
                            </div>
                            <div class="flex w-full flex-1 flex-col items-center rounded-xl bg-white p-2">
                                <div id="VideoPreviewAdd" class="flex h-full w-full items-center gap-2 overflow-x-auto text-black">
                                </div>
                            </div>
                        </div>

                        <!-- Images -->
                        <div class="flex flex-1 flex-col">
                            <div class="flex justify-between">
                                <p class="text-lg">Images</p>
                                <label for="ImageFilesAdd" class="cursor-pointer">
                                    <input type="file"
                                           name="ImageFilesAdd"
                                           id="ImageFilesAdd"
                                           accept="image/*"
                                           multiple
                                           class="hidden" />
                                    <div class="flex items-center text-white">
                                        <span class="material-symbols-outlined">add_photo_alternate</span>
                                        <h1 class="font-semibold uppercase">Upload</h1>
                                    </div>
                                </label>
                            </div>
                            <div class="flex w-full flex-1 flex-col items-center rounded-xl bg-white p-2">
                                <div id="ImagePreviewAdd" class="flex h-full w-full items-center gap-2 overflow-x-auto text-black">
                                </div>
                            </div>
                        </div>

                        <!-- Documents -->
                        <div class="flex flex-1 flex-col">
                            <div class="flex justify-between">
                                <div class="flex flex-col">
                                    <p class="text-lg">Documents</p>
                                    <p class="text-xs text-gray-300">PDF, Word, Excel, PowerPoint</p>
                                </div>
                                <label for="DocumentFilesAdd" class="cursor-pointer">
                                    <input type="file"
                                           name="DocumentFilesAdd"
                                           id="DocumentFilesAdd"
                                           accept="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation"
                                           multiple
                                           class="hidden" />
                                    <div class="flex items-center text-white">
                                        <span class="material-symbols-outlined">add_photo_alternate</span>
                                        <h1 class="font-semibold uppercase">Upload</h1>
                                    </div>
                                </label>
                            </div>
                            <div class="flex w-full flex-1 flex-col items-center rounded-xl bg-white p-2">
                                <div id="DocumentPreviewAdd" class="flex h-full w-full items-center gap-2 overflow-x-auto text-black">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    function addTopic(trainingId) {
        document.getElementById('addTopic').classList.remove('hidden');
        document.getElementById('TrainingId').value = trainingId;
    }

    function closeAddTopic() {
        document.getElementById('addTopic').classList.add('hidden');
        // Clear form
        document.getElementById('VideoPreviewAdd').innerHTML = '';
        document.getElementById('ImagePreviewAdd').innerHTML = '';
        document.getElementById('DocumentPreviewAdd').innerHTML = '';
        document.getElementById('VideoFilesAdd').value = '';
        document.getElementById('ImageFilesAdd').value = '';
        document.getElementById('DocumentFilesAdd').value = '';
    }

    function getFileExtension(filename) {
        return filename.split('.').pop().toUpperCase();
    }

    function getFileExtensionColor(extension) {
        switch(extension.toLowerCase()) {
            case 'pdf': return 'bg-red-500';
            case 'doc':
            case 'docx': return 'bg-blue-500';
            case 'xls':
            case 'xlsx': return 'bg-green-500';
            case 'ppt':
            case 'pptx': return 'bg-orange-500';
            default: return 'bg-gray-500';
        }
    }

    // Listen for file input changes and log selected files
    ['VideoFilesAdd', 'ImageFilesAdd', 'DocumentFilesAdd'].forEach(function(inputId) {
        var input = document.getElementById(inputId);
        if (input) {
            input.addEventListener('change', function(event) {
                if (event.target.files && event.target.files.length > 0) {
                    const fileNames = Array.from(event.target.files).map(f => f.name);
                    console.log(`[UPLOAD] ${inputId}: Selected files:`, fileNames);
                } else {
                    console.log(`[UPLOAD] ${inputId}: No files selected.`);
                }
            });
        }
    });

    function addNewFilePreview(previewId, file, icon, inputId) {
        const preview = document.getElementById(previewId);
        const div = document.createElement('div');
        div.className = 'flex flex-col items-center min-w-[60px] cursor-pointer media-item new';

        let fileInfo = '';
        if (inputId === 'DocumentFilesAdd') {
            const extension = getFileExtension(file.name);
            const colorClass = getFileExtensionColor(extension);
            fileInfo = `<span class='${colorClass} mt-1 rounded px-2 py-1 text-xs font-bold text-white'>${extension}</span>`;
        }

        div.innerHTML = `
            <span class="material-symbols-outlined text-black" style="font-size:30px">${icon}</span>
            <span class='w-[60px] truncate text-center text-xs text-black'>${file.name.substring(0, 10)}</span>
            ${fileInfo}
            <button type='button' class='delete-media-btn' style='color:red;'>
                <span class="material-symbols-outlined" style='font-size: 20px'>delete</span>
            </button>`;

        div.querySelector('.delete-media-btn').onclick = function(e) {
            div.remove();
            e.stopPropagation();
        };
        preview.appendChild(div);
    }

    document.getElementById('ImageFilesAdd').addEventListener('change', function(event) {
        const preview = document.getElementById('ImagePreviewAdd');
        Array.from(event.target.files).forEach(file => {
            addNewFilePreview('ImagePreviewAdd', file, 'image', 'ImageFilesAdd');
        });
    });

    document.getElementById('VideoFilesAdd').addEventListener('change', function(event) {
        const preview = document.getElementById('VideoPreviewAdd');
        Array.from(event.target.files).forEach(file => {
            addNewFilePreview('VideoPreviewAdd', file, 'movie', 'VideoFilesAdd');
        });
    });

    document.getElementById('DocumentFilesAdd').addEventListener('change', function(event) {
        const preview = document.getElementById('DocumentPreviewAdd');
        Array.from(event.target.files).forEach(file => {
            addNewFilePreview('DocumentPreviewAdd', file, 'description', 'DocumentFilesAdd');
        });
    });
</script>